<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TABU-AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            scrollbar-width: none;
        }

        body {
            height: 100vh;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 0.4;
            }

            50% {
                opacity: 1;
            }
        }

        .typing-indicator span {
            animation: pulse 1s infinite;
        }

        .message-appear {
            animation: messageAppear 0.3s ease-out;
        }

        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .gradient-text {
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .footer {

            width: 100%;
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            display: flex;
            justify-content: center;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen ">
    <div class="max-w-6xl mx-auto px-4 ">
        <!-- Header -->
        <header class="flex items-center justify-between mb-8">
            <div class="flex items-center space-x-4 ">
                <div class="w-12 h-12 rounded-full bg-blue-500 flex items-center justify-center">
                    <i class="fas fa-brain text-white text-xl"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold gradient-text">TABU AI</h1>
                    <p class="text-gray-500 text-sm">AI-Assistant</p>
                </div>
            </div>
            <div class="flex space-x-2">
                <!-- <button onclick="showModal()"  class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-full text-sm font-medium transition">Settings</button> -->
                <button onclick="clearChat()"
                    class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-full text-sm font-medium transition">Clear
                    Chat</button>
            </div>
        </header>

        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-6">
            <div id="chatContainer" class="p-6 h-96 overflow-y-auto">
                <div class="message-appear flex items-start mb-4">
                    <div class="bg-blue-100 p-3 rounded-xl rounded-tl-none max-w-3xl">
                        <div class="font-medium text-blue-600 mb-1">TABU AI</div>
                        <p>HELLO! how can i assist you?</p>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="border-t border-gray-200 p-4 bg-gray-50">
                <form id="messageForm" class="flex space-x-2" onsubmit="sendMessage(event)">
                    <div class="flex-grow flex">
                        <input id="messageInput" type="text" placeholder="Type your message..."
                            class="flex-1 px-4 py-2 rounded-l-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <button type="submit"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-r-full transition">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-xl p-6 max-w-md w-full">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">Settings</h2>
                    <button onclick="hideModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Max Tokens</label>
                        <input type="number" id="maxTokens" value="200" min="50" max="1000"
                            class="w-full border border-gray-300 rounded-md px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Temperature</label>
                        <input type="range" id="temperature" min="0" max="1" step="0.1" value="0.7" class="w-full">
                        <span id="tempValue" class="text-sm text-gray-600">0.7</span>
                    </div>
                </div>
            </div>
        </div>
        <footer class="footer min-h-2">
            <h1> &#169;AI BY SHUBH-DEV</h1>
        </footer>
    </div>


    <script>
        // API Configuration
        // Insert your API key directly here (not visible on screen)
        const API_KEY = 'AIzaSyAWNPb5bgI0HgO9Sgsbc4BLuzqD0tzlQ54';
        const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';

        function showModal() {
            document.getElementById('settingsModal').classList.remove('hidden');
        }

        function hideModal() {
            document.getElementById('settingsModal').classList.add('hidden');
        }

        function clearChat() {
            document.getElementById('chatContainer').innerHTML = '';
            addMessage('assistant', "Chat cleared! Ready for new messages.");
        }

        function addMessage(role, content, isCode = false, codeLang = '') {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-appear flex items-start mb-4';

            if (role === 'user') {
                messageDiv.innerHTML = `
                    <div class="ml-auto bg-gray-100 p-3 rounded-xl rounded-tr-none max-w-3xl">
                        <div class="font-medium text-gray-500 mb-1">You</div>
                        <p>${content}</p>
                    </div>
                `;
            } else if (isCode) {
                messageDiv.innerHTML = `
                    <div class="bg-black p-3 text-white rounded-xl rounded-tl-none max-w-3xl w-full overflow-x-auto ">
                        <div class="font-medium text-green-400 flex justify-between">
                            TABU AI ${codeLang ? <span class="text-xs text-gray-300">LANGUAGE-[${codeLang}]</span> : ''}
                        </div>
                        <pre class="text-green-200 mt-4 text-sm whitespace-pre-line" style="font-family: 'Fira Mono', 'Consolas', monospace;">${content}</pre>
                    </div>
                `;
            } else {
                // Format plain text line by line and step-wise
                // Replace numbered steps and newlines with <div> for each line
                // Handles both stepwise (1., 2., etc.) and linewise (\n)
                const lines = content.split('\n').filter(line => line.trim() !== '');
                const formatted = lines.map(line => {
                    // If line starts with a number and a dot, make it bold for steps
                    if (/^\d+\./.test(line.trim())) {
                        return <div class="mb-1"><span class="font-semibold">${line.trim().slice(0, line.indexOf('.') + 1)}</span> ${line.trim().slice(line.indexOf('.') + 1).trim()}</div>;
                    }
                    // Otherwise, just show as a normal line
                    return <div class="mb-1">${line}</div>;
                }).join('');
                messageDiv.innerHTML = `
                    <div class="bg-blue-100 p-3 rounded-xl rounded-tl-none max-w-3xl">
                        <div class="font-medium text-blue-600 mb-1 flex flex-col">TABU AI</div>
                        ${formatted}
                    </div>
                `;
            }

            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Helper to detect if the response contains code and its language
        function extractCodeBlock(text) {
            // Looks for triple backtick code blocks
            const codeBlockRegex = /([a-zA-Z0-9]*)\n([\s\S]*?)/g;
            let match = codeBlockRegex.exec(text);
            if (match) {
                // match[1] is the language (may be empty), match[2] is the code
                return { code: match[2], lang: match[1] || 'code' };
            }
            return null;
        }

        // Gemini API Function (fixed, uses API_KEY directly)
        async function callAPI(prompt) {
            const maxTokens = parseInt(document.getElementById('maxTokens').value) || 200;
            const temperature = parseFloat(document.getElementById('temperature').value) || 0.7;

            // Manual response for "tell me about yourself"
            if (
                prompt.trim().toLowerCase() === "tell me about yourself?" ||
                prompt.trim().toLowerCase() === "tell us about yourself?" ||
                prompt.trim().toLowerCase() === "who are you?" ||
                prompt.trim().toLowerCase() === "tell me about you?" ||
                prompt.trim().toLowerCase() === "what is your aim?" ||
                prompt.trim().toLowerCase() === "what can you do?"
            ) {
                // Replace the text below with your manual response
                return { text: "I am TABU AI, your personal assistant. I can help you with a variety of tasks, from answering questions to providing information on various topics. My goal is to assist you in the best way possible!", isCode: false, codeLang: '' };
            }

            // Gemini expects API key as a query param
            const apiUrl = ${ API_URL }?key = ${ API_KEY };

            const payload = {
                contents: [
                    { parts: [{ text: prompt }] }
                ],
                generationConfig: {
                    maxOutputTokens: maxTokens,
                    temperature: temperature
                }
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || 'No response received';

                // Check if the response contains a code block
                const codeObj = extractCodeBlock(aiText);
                if (codeObj) {
                    return { text: codeObj.code, isCode: true, codeLang: codeObj.lang };
                } else {
                    return { text: aiText, isCode: false, codeLang: '' };
                }

            } catch (error) {
                console.error('API Error:', error);
                return { text: Error: ${ error.message }. Please check your API configuration., isCode: false, codeLang: ''
            };
        }
        }

        async function sendMessage(e) {
            e.preventDefault();
            const input = document.getElementById('messageInput');
            const message = input.value.trim();

            if (!message) return;

            // Add user message
            addMessage('user', message);
            input.value = '';

            // Show loading state
            addMessage('assistant', '⏳ Processing...');

            // Call API
            const response = await callAPI(message);

            // Replace loading message with actual response
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.lastChild.remove();
            addMessage('assistant', response.text, response.isCode, response.codeLang);
        }

        // Temperature slider update
        document.getElementById('temperature').addEventListener('input', function () {
            document.getElementById('tempValue').textContent = this.value;
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            console.log('TABU AI initialized with API support');
            console.log('Configure your API endpoint in the settings above');
        });
    </script>
</body>

</html>